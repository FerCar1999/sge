function get_data_callback_permisos(){$.ajax({data:{limit:itemsPorPagina,offset:desde,busqueda:$.trim($("input#buscar_permiso").val()),orden:"nombre",estado:ver_estado_permiso},type:"POST",url:url_listar_permisos}).done(function(a,b,c){var d=a.lista;$(".table").html(""),0==pagina&&creaPaginador(a.cantidad),$.each(d,function(a,b){"Activo"==ver_estado_permiso?$('<tr id="+elem.id+"><td>'+b.nombre+'</td><td><a onclick="ver_permiso('+b.id+",'"+b.nombre+'\')" class="btn-floating green" ><i  class="material-icons">edit</i></a> <a onclick=eliminar_permiso('+b.id+",'"+b.nombre+'\') class="btn-floating green"><i class="material-icons">delete</i></a> <a onclick="acceso_permiso('+b.id+",'"+b.nombre+'\')" class="btn-floating red" ><i  class="material-icons">lock </i></a></td></tr>').appendTo($(".table")):$('<tr id="+elem.id+"><td>'+b.nombre+"</td><td><a onclick=activar_permiso("+b.id+",'"+b.nombre+'\') class="btn-floating teal"><i class="material-icons">delete</i></a></td></tr>').appendTo($(".table"))})}).fail(function(a,b,c){swal("Error al realizar la petición dame".textError)})}function ver_permiso(a,b){pk_permiso=a,$(".agregar_permiso").hide("fast"),$(".modificar_permiso").show("fast"),$(".permiso_modulos").hide("fast"),$(".eliminar_permiso").hide("fast"),$("#modificar_nombre").val(b),$("label").addClass("active")}function eliminar_permiso(a,b){pk_permiso=a,$(".agregar_permiso").hide("fast"),$(".permiso_modulos").hide("fast"),$(".modificar_permiso").hide("fast"),$(".eliminar_permiso").show("fast"),$("#confirmacion").text("¿Desea desactivar el permiso '"+b+"'?"),estado_permiso="Inactivo"}function activar_permiso(a,b){pk_permiso=a,$(".agregar_permiso").hide("fast"),$(".modificar_permiso").hide("fast"),$(".eliminar_permiso").hide("fast"),$(".permiso_modulos").hide("fast"),$(".activar_permiso").show("fast"),$("#confirmacion2").text("¿Desea activar el permiso '"+b+"'?"),estado_permiso="Activo"}function acceso_permiso(a,b){fk_permiso=a,$(".agregar_permiso").hide("fast"),$(".modificar_permiso").hide("fast"),$(".eliminar_permiso").hide("fast"),$(".permiso_modulos").show("fast"),$("#titulo_acceso").text("Acceso "+b),$.ajax({data:{limit:0,offset:0,busqueda:"",orden:"nombre"},type:"POST",url:url_listar_modulos}).done(function(a,b,c){var d=a.lista;$("#modulos").html(""),$.each(d,function(a,b){$('<div class="col s6"><input  id='+b.id+' class="access_check" type="checkbox" ><label id='+b.id+" for="+b.id+">"+b.nombre+"</label></div>").appendTo($("#modulos"))}),verificar_acceso()}).fail(function(a,b,c){swal("Error al realizar la petición dame".textError)})}function verificar_acceso(){for(var a=$(".access_check"),b=$(".access_check").size(),c=[],d=0;d<b;d++)c[d]=$(a[d]).attr("id");$.ajax({data:{id_permiso:fk_permiso,token:$("#dpToken").val()},type:"POST",url:url_modulo_permisos}).done(function(d,e,f){var g=d.lista;$.each(g,function(d,e){for(var f=0;f<b;f++)parseInt(e.id)==parseInt(c[f])&&$(a[f]).attr("checked",!0)})}).fail(function(a,b,c){swal("Error al realizar la petición dame".textError)})}function permisos_init(){cargaPagina(0),$(".modificar_permiso").hide("fast"),$(".eliminar_permiso").hide("fast"),$(".activar_permiso").hide("fast"),$(".permiso_modulos").hide("fast"),$(".agregar_permiso").show("fast")}var url_listar_permisos="/privado/php/permisos/permisos_listar.php",url_permisos="/privado/php/permisos/permisos.php",url_modulo_permisos="/privado/php/permisos/modulos_permiso.php",url_listar_modulos="/privado/php/permisos/modulos.php",url_guardar_acceso="/privado/php/permisos/guardar_acceso.php",url_eliminar_permiso="/privado/php/permisos/eliminar_permisos.php",pk_permiso,ver_estado_permiso="Activo",estado_permiso="Inactivo";$(document).ready(function(){paginador=$(".pagination");var a=3,b=3;init_paginator(paginador,a,b),set_callback(get_data_callback_permisos),permisos_init()}),$("#buscar_permiso").keyup(function(){permisos_init()}),$("#agregar_permiso").click(function(a){$.post(url_permisos,{id:null,nombre:$("#nombre").val(),token:$("#dpToken").val()},function(a){swal(a),permisos_init()})}),$("#modificar_permiso").click(function(a){$.post(url_permisos,{id:pk_permiso,nombre:$("#modificar_nombre").val(),token:$("#dpToken").val()},function(a){swal(a),permisos_init()})}),$("#eliminar_permiso").click(function(a){$.post(url_eliminar_permiso,{id:pk_permiso,estado:estado_permiso,token:$("#dpToken").val()},function(a){permisos_init(),swal(a)})}),$("#activar_permiso").click(function(a){$.post(url_eliminar_permiso,{id:pk_permiso,estado:estado_permiso,token:$("#dpToken").val()},function(a){permisos_init(),swal(a)})}),$("#guardar_acceso").click(function(a){for(var b=$(".access_check"),c=$(".access_check").size(),d=[],e=0;e<c;e++)$(b[e]).parent().children().prop("checked")&&(d[e]=$(b[e]).attr("id"));var f=JSON.stringify(d);$.post(url_guardar_acceso,{id_permiso:fk_permiso,permisos:f,token:$("#dpToken").val()},function(a){location.reload()}),permisos_init()}),$("#ver_permisos_activos").click(function(a){"Activo"!=ver_estado_permiso&&(ver_estado_permiso="Activo",set_callback(get_data_callback_permisos),permisos_init())}),$("#ver_permisos_inactivos").click(function(a){"Inactivo"!=ver_estado_permiso&&(ver_estado_permiso="Inactivo",set_callback(get_data_callback_permisos),permisos_init())});