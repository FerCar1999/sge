function obtenerAlumnos(){return $.ajax({type:"POST",url:url_listar_alumnos,async:!1,data:{busqueda:$("input.autocomplete").val(),estado:"Activo"},dataType:"json",success:function(valores){var resp=eval(valores);return $.each(resp,function(a,b){var c=b.alumno,d=b.foto;autocompleteAlumnos[c]=d}),$("input.autocomplete").autocomplete({data:autocompleteAlumnos}),!1}}),!1}function breakChange(){$("input.autocomplete").change(function(){})}function initChange(){$("input.autocomplete").change(function(){pk_alumno=$("input.autocomplete").val().substring(0,8),pk_alumno>7&&setTimeout(function(){asignarLlegadaTarde(pk_alumno)},100)})}function asignarLlegadaSwal(a){swal({title:"¿Asignar llegada tarde?",text:"",type:"info",showCancelButton:!0,confirmButtonColor:"#0277bd",confirmButtonText:"Sí",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0},function(b){b&&asignarLlegadaTarde(a)})}function asignarLlegadaTarde(a){$.post(url_asignar_llegada,{pk_alumno:a},function(a){switch(a){case"success":Materialize.toast("Llegada tarde asignada.",3e3,"rounded"),cargar_historial_tardanza(),$("input.autocomplete").val(""),$("input.autocomplete").focus();break;case"error":swal("Error al procesar petición.","error");break;default:Materialize.toast("Ha ocurrido un error.",3e3,"rounded")}})}function asignarLlegadaTardeManual(a){$.post(url_asignar_llegada,{pk_alumno:a,hora:$("#horaLlegada").val(),token:$("#dpToken").val()},function(a){switch(a){case"success":Materialize.toast("Llegada tarde asignada.",3e3,"rounded"),cargar_historial_tardanza();break;case"error":swal("Error al procesar petición.","error");break;default:Materialize.toast("Ha ocurrido un error."+a,3e3,"rounded")}})}function cargar_historial_codigo(a){$.ajax({data:{id:a},type:"POST",url:url_cargar_historial}).done(function(a,b,c){var d=a.lista;$(".licodigos").html(""),$.each(d,function(a,b){$("<tr><td>"+b.tipo+"</td><td>"+b.codigo+"</td><td>"+b.fecha+'</td><td><a href="#!" class="btn-floating tooltipped" data-position="left" data-delay="50" data-tooltip="Quitar código" onclick="eliminar_codigo('+b.id+')"><i class="material-icons">highlight_off</i></a> <a href="#!" class="btn-floating tooltipped" data-position="left" data-delay="50" data-tooltip="Ver observación" onclick="swal(\'Observación\',\''+b.observacion+'\')"><i class="material-icons">list</i></a></td><tr>').appendTo($(".licodigos"))})}).fail(function(a,b,c){$(".licodigos").html("")})}function cargar_historial_tardanza(){$.ajax({data:{},type:"POST",url:url_cargar_historial_impuntual}).done(function(a,b,c){var d=a.lista;$(".liimpuntual").html(""),$.each(d,function(a,b){$("<tr><td>"+b.nombre+"</td><td>"+b.fecha+'</td><td><a href="#!" class="btn-floating tooltipped" data-position="left" data-delay="50" data-tooltip="Quitar código" onclick="eliminar_impuntualidad('+b.id+')"><i class="material-icons">highlight_off</i></a> <a href="#!" class="btn-floating tooltipped" data-position="left" data-delay="50" data-tooltip="Quitar código" onclick="asignar_codigo(\''+b.alumno+'\')"><i class="material-icons">gavel</i></a></td><tr>').appendTo($(".liimpuntual"))})}).fail(function(a,b,c){$(".liimpuntual").html("")})}function asignar_codigo(a){$("#codigos").show(),$("#asginarCodigo").show(),$("#cancelarCodigo").show(),$("#mostrarCodigo").hide(),$("#cleanText").hide(),$("input.autocomplete").val(a),pk_alumno=$("input.autocomplete").val().substring(0,8)}function eliminar_impuntualidad(a){$.post(url_quitar_impuntualidad,{pk_impuntualidad:a,token:$("#dpToken").val()},function(a){Materialize.toast(a,3e3,"rounded"),cargar_historial_tardanza()})}function eliminar_codigo(a){$.post(url_quitar_codigo,{id:10,pk_disciplina:a,token:$("#dpToken").val()},function(a){Materialize.toast(a,3e3,"rounded"),cargar_historial_codigo(pk_alumno)})}function impuntualidad_init(){$("#codigos").hide(),$("#asginarCodigo").hide(),$("#cancelarCodigo").hide(),$("#asginarTardanza").hide(),$("#horaLlegadaDiv").hide(),$("#mostrarCodigo").show(),$("#cleanText").show(),$("input.autocomplete").focus()}var url_listar_alumnos="/privado/php/impuntualidad/listarAlumnos.php",url_asignar_llegada="/privado/php/impuntualidad/impuntualidad.php",url_asignar_codigo="/privado/php/disciplina/asignar_codigos.php",url_cargar_historial="/privado/php/impuntualidad/historialCodigos.php",url_cargar_historial_impuntual="/privado/php/impuntualidad/historialImpuntualidad.php",url_quitar_codigo="/privado/php/disciplina/quitar_codigo.php",url_quitar_impuntualidad="/privado/php/impuntualidad/quitar_impuntualidad.php",autocompleteAlumnos={},pk_alumno,alumno;$(document).ready(function(){$("select").material_select(),obtenerAlumnos(),impuntualidad_init(),cargar_historial_tardanza(),initChange(),$("input.autocomplete").focus(),$(".timepicker").pickatime({default:"now",twelvehour:!1,donetext:"Aceptar",autoclose:!1,vibrate:!0,darktheme:!0})}),$("#cleanText").click(function(){breakChange(),setTimeout(function(){initChange()},100),$("input.autocomplete").val(""),$("input.autocomplete").focus()}),$("#mostrarCodigo").click(function(){$("#codigos").show(),$("#asginarCodigo").show(),$("#cancelarCodigo").show(),$("#mostrarCodigo").hide(),$("#cleanText").hide()}),$("#asginarCodigo").click(function(){$.ajaxSetup({async:!1});for(var a=!1,b=0;b<$("#selectCodigos").val().length;b++)$.post(url_asignar_codigo,{pk_alumno:pk_alumno,pk_codigo:$("#selectCodigos").val()[b],pk_observacion:"Pendiente",token:$("#dpToken").val()},function(b){switch(b){case"Código asignado correctamente.":a=!0;break;case"camposFalta":swal("Error",b,"error");break;default:swal("Error",b,"error")}});a&&(swal("Códigos asignados.","","success"),$("#selectCodigos").val(""),$("select").material_select(),cargar_historial_codigo(pk_alumno))}),$("#asginarTardanza").click(function(){pk_alumno=$("input.autocomplete").val().substring(0,8),pk_alumno>7?asignarLlegadaTardeManual(pk_alumno):Materialize.toast("Seleccione un estudiante.",3e3,"rounded")}),$("#cancelarCodigo").click(function(){$("#codigos").hide(),breakChange(),setTimeout(function(){initChange()},100),$("input.autocomplete").val(""),$("input.autocomplete").focus(),impuntualidad_init()}),$("#manualRadio").click(function(){$("input.autocomplete").off("change"),$("input.autocomplete").on("change",function(){pk_alumno=$("input.autocomplete").val().substring(0,8)}),$("#horaLlegadaDiv").show(),$("#asginarTardanza").show()}),$("#automaticRadio").click(function(){$("input.autocomplete").on("change",function(){pk_alumno=$("input.autocomplete").val().substring(0,8),pk_alumno>7&&setTimeout(function(){asignarLlegadaTarde(pk_alumno)},100)}),$("#horaLlegadaDiv").hide(),$("#asginarTardanza").hide()});