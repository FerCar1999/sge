function etapas_init(){cargaPagina(0),$("#formAgregar").show(),$("#formMod").hide(),$("#formElim").hide(),$("#formAct").hide()}function get_data_callback_asuetos(){$.ajax({data:{limit:itemsPorPagina,offset:desde,busqueda:$.trim($("input#buscar_asueto").val()),estado:ver_estado_etapa},type:"POST",url:url_listar_etapas}).done(function(a,b,c){var d=a.lista;$(".table").html(""),0==pagina&&creaPaginador(a.cantidad),$.each(d,function(a,b){"Activo"==ver_estado_etapa?$('<tr id="+elem.id+"><td>'+b.nombre+"</td><td>"+b.inicio+"</td><td>"+b.fin+'</td><td><a onclick="ver_etapa('+b.id+",'"+b.nombre+"','"+b.inicio+"','"+b.fin+"','"+b.descripcion+"',"+b.nivel+')" class="btn-floating green" ><i  class="material-icons">edit</i></a> <a onclick="eliminaretapa('+b.id+",'"+b.nombre+'\')" class="btn-floating green"><i class="material-icons">delete</i></a></td></tr>').appendTo($(".table")):$('<tr id="+elem.id+"><td>'+b.nombre+"</td><td>"+b.inicio+"</td><td>"+b.fin+'</td><td><a onclick="activar_etapa('+b.id+",'"+b.nombre+"',"+b.nivel+')" class="btn-floating green" ><i  class="material-icons">autorenew</i></a></td></tr>').appendTo($(".table"))})}).fail(function(a,b,c){alert("Error al realizar la peticion dame".textError)})}function eliminaretapa(a,b){pk_etapa=a,$("#formAgregar").hide(),$("#formMod").hide(),$("#formElim").show(),$("#confirmacion").text("¿Desea desactivar la etapa "+b+"?"),estado_asueto="Inactivo"}function activar_etapa(a,b,c){pk_etapa=a,nivel=c,estado_etapa="Activo",$("#formAct").show(),$("#formElim").hide(),$("#formMod").hide(),$("#formAgregar").hide(),$("#confirmacion_activar").text("¿Desea activar la etapa "+b+"?")}function ver_etapa(a,b,c,d,e,f){pk_etapa=a,$("#mod_nombre").val(b),$("#mod_descripcion").val(e),$("#mod_date_inicio").val(c),$("#mod_date_fin").val(d),$("label").addClass("active"),$("#selectModNivel").find('option[value="'+f+'"]').prop("selected",!0),$("#selectModNivel").material_select(),$("label.selectlbl").removeClass("active"),$("#formAgregar").hide(),$("#formMod").show(),$("#formElim").hide(),$("#formAct").hide()}var url_listar_etapas="/privado/php/etapas/etapasListar.php",url_guardar_etapa="/privado/php/etapas/etapas.php",url_eliminar_etapa="/privado/php/etapas/eliminarEtapa.php",pk_etapa,estado_etapa="Inactivo",ver_estado_etapa="Activo",nivel=0;$(document).ready(function(){$(".datepicker").pickadate({monthsFull:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthsShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],weekdaysFull:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],weekdaysShort:["Dom","Lun","Mar","Mie","Jue","Vie","Sáb"],today:"Hoy",clear:"Limpiar",close:"Cerrar",labelMonthNext:"Adelante",labelMonthPrev:"Atras",labelMonthSelect:"Selecciona un mes",labelYearSelect:"Selecciona un año",format:"yyyy-mm-dd",formatSubmit:"yyyy/mm/dd",selectMonths:!0,selectYears:100,closeOnSelect:!0}),paginador=$(".pagination");var a=3,b=3;init_paginator(paginador,a,b),set_callback(get_data_callback_asuetos),etapas_init(),$("select").material_select()}),$("#agregar").click(function(a){$.post(url_guardar_etapa,{nombre:$("#nombre").val(),descripcion:$("#descripcion").val(),inicio:$("#date_inicio").val(),fin:$("#date_fin").val(),nivel:$("#selectNivel").val()},function(a){switch(a){case"success":Materialize.toast("Etapa agregada.",5e3,"rounded"),etapas_init();break;case"error":Materialize.toast("Ha ocurrido un error en su solicitud.",1e4,"rounded");break;default:Materialize.toast(a,5e3,"rounded")}})}),$("#modificar").click(function(a){$.post(url_guardar_etapa,{id:pk_etapa,nombre:$("#mod_nombre").val(),descripcion:$("#mod_descripcion").val(),inicio:$("#mod_date_inicio").val(),fin:$("#mod_date_fin").val(),nivel:$("#selectModNivel").val()},function(a){switch(a){case"success":Materialize.toast("Etapa modificada.",5e3,"rounded"),etapas_init();break;case"error":Materialize.toast("Ha ocurrido un error en su solicitud.",1e4,"rounded");break;default:Materialize.toast(a,5e3,"rounded")}})}),$("#ver_etapas_activas").click(function(a){"Activo"!=ver_estado_etapa&&(ver_estado_etapa="Activo",set_callback(get_data_callback_asuetos),etapas_init())}),$("#ver_etapas_inactivas").click(function(a){"Inactivo"!=ver_estado_etapa&&(ver_estado_etapa="Inactivo",set_callback(get_data_callback_asuetos),etapas_init())}),$("#buscar_etapa").keyup(function(){etapas_init()}),$("#eliminar").click(function(a){$.post(url_eliminar_etapa,{id:pk_etapa,estado:estado_etapa},function(a){if(etapas_init(),""!=a)switch(a){case"success":Materialize.toast("Etapa desactivada.",5e3,"rounded"),etapas_init();break;case"error":Materialize.toast("Ha ocurrido un error en su solicitud.",1e4,"rounded");break;default:Materialize.toast(a,5e3,"rounded")}})}),$("#activar").click(function(a){$.post(url_eliminar_etapa,{id:pk_etapa,estado:estado_etapa,nivel:nivel},function(a){switch(a){case"success":Materialize.toast("Etapa activada.",5e3,"rounded"),etapas_init();break;case"error":Materialize.toast("Ha ocurrido un error en su solicitud.",1e4,"rounded");break;default:Materialize.toast(a,5e3,"rounded")}})});